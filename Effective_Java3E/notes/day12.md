# Day 12. 일반적인 프로그래밍 원칙 Part 2. / Item 64~68

---
---

## Item 64 객체는 인터페이스를 사용해 참조하라.

- 아이템 51에서 매개변수 타입으로 클래스가 아니라 인터페이스를 사용하라고 했다.
- 이 조언을 "객체는 클래스가 아닌 인터페이스로 참조하라"고까지 확장할 수 있다.
- 적합한 인터페이스만 있다면 매개변수뿐 아니라 반환값, 변수, 필드를 전부 인터페이스 타입으로 선언하라.

```java
// 좋은 예 인터페이스를 타입으로 사용
Set<Son> sonSet=new LinkedHashSet<>();

// 나쁜 예, 클래스를 타입으로 사용!
        linkedHashSet<Son> sonSet=new LinkedHashSet<>();
```

- 인터페이스를 타입으로 사용하는 습관을 길러두면 프로그램이 훨씬 유연해질 것이다. 나중에 구현 클래스를 교체하고자 한다면 그저 새 클래스의 생성자 (혹은 다른 정적 팩터리)를 호출해주기만 하면 된다.
- 적합한 인터페이스가 없다면 당연히 클래스로 참조해야 한다. 그러한 세가지 부류가 존재한다.
    - String 과 BigInteger 같은 값 클래스가 그렇다.
    - 클래스 기반으로 작성된 프레임워크가 제공하는 객체들이다. Outputstream 등..
    - 인터페이스에는 없는 특별한 메서드를 제공하는 클래스들이다
        - 예를들어 PriorityQueue 클래스.
- 적합한 인터페이스가 없다면 클래스의 계층구조 중 필요한 기능을 만족하는 가장 덜 구체적인(상위의) 클래스를 타입으로 사용하자.

---
---

## Item 65 리플렉션보다는 인터페이스를 사용하라.

- 리플렉션을 이용하면 컴파일 당시에 존재하지 않던 클래스도 이용할 수 있는 장점이 있지만
- 단점으로는
    - 컴파일타임 타입 검사가 주는 이점을 하나도 누릴 수 없다.
        - 예외 검사도 마찬가지다.
    - 리플렉션을 이용하면 코드가 지저분하고 장황해진다.
        - 지루하고 읽기도 어렵다.
    - 성능이 떨어진다.
        - 리플렉션을 통한 메서드 호출은 일반 메서드 호출보다 훨씬 느리다.
- 코드 분석 도구나 의존관계 주입 프레임워크 처럼 리플렉션을 써야 하는 복잡한 애플리케이션이 몇 가지 있다. 하지만 이런 도구들마저 리플렉션 사용을 점차 줄이고 있다. 단점이 명백하기 때문이다.
- 리플렉션은 아주 제한된 형태로만 사용해야 그 단점을 피하고 이점만 취할 수 있다.
- 리플렉션은 인스턴스 생성에만 쓰고, 이렇게 만든 인스턴스는 인터페이스나 상위 클래스로 참조해 사용하자.

### 핵심 정리

- 리플렉션은 복잡한 특수 시스템을 개발할 때 필요한 강력한 기능이지만, 단점도 많다.
- 컴파일 타임에는 알 수 없는 클래스를 사용하는 프로그램을 작성한다면 리플렉션을 사용해야 할 것이다.
- 단, 되도록 객체 생성에만 사용하고, 생성한 객체를 이용할 때는 적절한 인터페이스나 컴파일 타임에 알 수 있는 상위 클래스로 형변환해 사용해야 한다.

---
---

## Item 66 네이티브 메서드는 신중히 사용하라.

- 성능을 개선할 목적으로 네이티브 메서드를 사용하는 것은 거의 권장하지 않는다.

### 핵심 정리

- 네이티브 메서드를 사용하려거든 한번 더 생각하라. 네이티브 메서드가 성능을 개선해 주는 일은 많지 않다.
- 로우레벨 자원이나 네이티브 라이브러리를 사용해야만 해서 어쩔 수 없더라도 네이티브 코드는 최소한만 사용하고 철저히 테스트하라.
- 네이티브 코드 안에 숨은 단 하나의 버그가 여러분 애플리케이션 전체를 훼손할 수도 있다.

---
---

## Item 67 최적화는 신중히 하라.

모든 사람이 마음 깊이 새겨야 할 최적화 격언 3개를 소개한다.

> 1번
>
> (맹목적인 어리석음을 포함해) 그 어떤 핑꼐보다 효율성이라는 이름 아래 행해진 컴퓨팅 죄악이 더 많다.(심지어 효율을 높이지도 못하면서). - 윌리엄 울프
>
> 2번
> 
> (전체의 97% 정도인) 자그마한 효율성은 모두 잊자. 섣부른 최적화가 만악의 근원이다. - 도널드 크누스
>
> 3번 
>
> 최적화를 할 때는 다음 두 규칙을 따르라.
>    - 첫 번째, 하지마라.
>    - 두 번째, (전문가 한정) 아직 하지 마라. 다시 말해, 완전히 명백하고 최적화되지 않은 해법을 찾을 때까지는 하지마라.

- 성능 때문에 견고한 구조를 희생하지 말자. 빠른 프로그램보다는 좋은 프로그램을 작성하라.
- 좋은 프로그램이지만 원하는 성능이 나오지 않는다면 그 아키텍처 자체가 최적화할 수 있는 길을 안내해줄 것이다.
- 좋은 프로그램은 정보 은닉 원칙을 따르므로 개별 구성요소의 내부를 독립적으로 설계할 수 있다.
- 따라서 시스템의 나머지에 영향을 주지 않고도 각 요소를 다시 설계할 수 있다.
- 프로그램을 완성할 때까지 성능 문제를 무시하라는 뜻이아니다.
- 구현상의 문제는 나중에 해결할 수 있지만, 아키텍처 결함이 성능을 제한하는 상황이라면 시스템 전체를 다시 작성하지 않고는 해결하기 불가능할 수 있다.
- 완성된 설계의 기본 틀을 변경하려다 보면 유지보수하거나 개선하기 어려운 꼬인 구조의 시스템이 만들어지기 쉽기 때문이다.
- 따라서 설계 단계에서 성능을 반드시 염두에 두어야 한다.
- 성능을 제한하는 설계를 피하라.
- 완성후 변경하기가 가장 어려운 설계 요소는 바로 컴포넌트 끼리, 혹은 외부 시스템 과의 소통 방식이다.
- API 를 설계할 때 성능에 주는 영향을 고려하라. 다행히 잘 설계된 API 는 성능도 좋은게 보통이다. 그러니 성능을 위해 API를 왜곡하는 건 매우 안 좋은 생각이다.
- 잭슨이 소개한 "하지마라" 와 "아직 하지 마라" 다음으로 하나를 더 추가한다면 "각각의 최적화 시도 전후로 성능을 측정하라" 정도가 되겠다.

> Profiling 도구는 최적화 노력을 어디에 집중해야 할지 찾는 데 도움을 준다.
> 
> 이런 도구는 개별 메서드의 소비 시간과 호출 횟수 같은 런타임 정보를 제공하여, 집중할 곳은 물론 알고리즘을 변경해야 한다는 사실을
알려주기도 한다.

- 프로그램에 시간이 거듭제곱으로 증가하는 알고리즘이 숨어 있다면 더 효율적인 것으로 교체해야 한다.
- 그러면 다른 튜닝을 하지 않아도 문제가 사라질 것이다.
- 시스템 규모가 커질수록 프로파일러가 더 중요해진다.
- 건초더미에서 바늘찾기와 비슷하다. 건초더미가 거대해질수록 금속탐지기가 더 절실해진다.
- 그 외에 jmh 도 언급해둘 만한 도구다.
- 프로파일러는 아니지만 자바코드의 성능을 쉽게 보여주는 마이크로 벤치마킹 프레임워크다.

> 성능 모델이 덜 정교한 자바에서는 기본 연산에 드는 상대적인 비용을 덜 명확하게 정의하고 있다.
> 
> 다시 말해 프로그래머가 작성하는 코드와 CPU 에서 수행하는 명령 사이의 '추상화 격차'가 커서 최적화로 인한 성능
변화를 일정하게 예측하기가 그만큼 더 어렵다.
> 
> 자바의 성능 모델은 정교하지 않을뿐더러 구현 시스템, 릴리즈, 프로세서마다 차이가 있다. 여러분의 프로그램을 여러 가지 자바 플랫폼이나 여러 하드웨어 플랫폼에서 구동한다면 최적화의 효과를 그 각각에서 측정해야 한다.

### 핵심 정리

- 빠른 프로그램을 작성하려 안달하지 말자.
- 좋은 프로그램을 작성하다 보면 성능은 따라오게 마련이다.
- 하지만 시스템을 설계할 대, 특히, API, 네트워크 프로토콜, 영구 저장용 데이터 포맷을 설계할 때는 성능을 염두에 두어야 한다.
- 시스템 구현을 완료했다면 이제 성능을 측정해보라. 충분히 빠르다면 그것으로 끝이다.
- 그렇지 않다면 문제의 원인이 되는 지점을 찾아 최적화를 수행하라.
- 가장 먼저 어떤 알고리즘을 사용했는지를 살펴보자. 알고리즘을 잘못 골랐다면 다른 저수준 최적화는 아무리 해봐야 소용이 없다. 만족할 때까지 이
  과정을 반복하고, 모든 변경 후에는 성능을 측정하라.

---
---

## Item 68 일반적으로 통용되는 명명 규칙을 따르라.

### 핵심 정리

- 표준 명명 규칙을 체화하여 자연스럽게 베어 나오도록 하자.
- 철자 규칙은 직관적이라 모호한 부분이 적은 데 반해, 문법 규칙은 더 복잡하고 느슨하다. 자바 언어 명세의 말을 인용하자면 "오랫동안 따라온 규칙과 충돌한다면 그 규칙을 맹종해서는 안된다." 상식이 이끄는 대로
  따르자.

-----
